<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç»ˆç«¯ç®¡ç†é¢æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .terminal-output {
        font-size: 14px;
        line-height: 1.5;
      }
      .prompt {
        color: #3e90f0;
      }
      .command {
        color: #c5c5c5;
      }
      .output {
        color: #d4d4d4;
        white-space: pre-wrap;
      }
      .error {
        color: #f48771;
      }
      .resize-y {
        resize: vertical;
        overflow: auto;
      }
      .switch {
        position: relative;
        display: inline-block;
        width: 42px;
        height: 22px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.3s;
        border-radius: 9999px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #06b6d4;
      }

      input:checked + .slider:before {
        transform: translateX(20px);
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
      <header class="mb-6 text-center">
        <h1 class="text-2xl font-bold text-cyan-400">æœåŠ¡å™¨ç»ˆç«¯ç®¡ç†</h1>
      </header>

      <section class="mb-6">
        <div
          class="sticky top-0 bg-gray-900 z-20 mb-4 p-2 flex flex-wrap items-center gap-2"
        >
          <h2 class="text-xl font-semibold text-cyan-300 flex-none">
            ç³»ç»Ÿç›‘æ§
          </h2>

          <div class="flex items-center space-x-2">
            <span class="text-sm text-gray-300"></span>
            <label class="switch">
              <input type="checkbox" id="toggleServers" />
              <span class="slider"></span>
            </label>
            <span class="text-sm text-gray-300"></span>
          </div>

          <input
            type="password"
            id="monitorPass"
            placeholder="ç›‘æ§å¯†ç "
            value="guest"
            class="flex-1 min-w-[120px] bg-gray-700 text-white px-2 py-1 rounded text-sm"
          />
          <input
            type="text"
            id="newServer"
            placeholder="æœåŠ¡å™¨åœ°å€"
            class="flex-1 min-w-[120px] bg-gray-700 text-white px-2 py-1 rounded text-sm"
          />
          <input
            type="text"
            id="serverTag"
            placeholder="è‡ªå®šä¹‰åç§°"
            class="flex-1 min-w-[120px] bg-gray-700 text-white px-2 py-1 rounded text-sm"
          />
          <button
            onclick="addServer()"
            class="flex-none bg-green-500 hover:bg-green-400 text-white px-2 py-1 rounded text-sm"
          >
            +
          </button>
        </div>

        <!-- æœåŠ¡å™¨åˆ—è¡¨ -->
        <div
          id="server-cards"
          class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 text-sm mb-4"
        >
          <div
            class="bg-gray-800 p-4 rounded cursor-pointer hover:bg-gray-700"
            onclick="showServerInfo('guest')"
          >
            guest
          </div>
        </div>

        <!-- æœåŠ¡å™¨ä¿¡æ¯é¢æ¿ -->
        <div id="server-info" class="bg-gray-800 p-4 rounded hidden">
          <h3 class="text-lg font-semibold mb-2">æœåŠ¡å™¨: guest</h3>
          <ul class="list-disc list-inside">
            <li>CPU: 4 Cores</li>
            <li>å†…å­˜: 8GB</li>
            <li>ç£ç›˜1: 100GB</li>
            <li>ç£ç›˜2: 100GB</li>
            <li>æµé‡: 1TB</li>
            <li>IP: 192.168.0.100</li>
          </ul>
          <h4 class="mt-4 font-semibold">æ–‡ä»¶å¤¹åˆ—è¡¨</h4>
          <ul class="list-disc list-inside">
            <li>Images</li>
            <li>Documents</li>
            <li>
              Build
              <ul class="list-disc list-inside ml-5">
                <li>project_address.txt</li>
                <li>README.md</li>
                <li>guest.txt</li>
              </ul>
            </li>
          </ul>
        </div>
      </section>

      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Bash é¢æ¿ -->
        <section class="flex-1 flex flex-col min-w-0">
          <div
            class="bg-[#1e1e1e] rounded-xl shadow-xl p-4 flex flex-col flex-1 resize-y min-w-0"
          >
            <div class="mb-4 flex flex-col sm:flex-row items-center gap-3">
              <label>ç®¡ç†å‘˜å¯†ç ï¼š</label>
              <input
                type="password"
                id="admin"
                placeholder="è¾“å…¥å¯†ç "
                value="guest"
                class="bg-gray-700 text-white px-2 py-1 rounded text-sm flex-1"
              />
              <button
                onclick="clearOutput()"
                class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm"
              >
                æ¸…ç©º
              </button>
            </div>

            <div
              id="output"
              class="terminal-output bg-black p-4 rounded flex-1 min-h-[300px] max-h-[600px] overflow-y-auto mb-4 min-w-0"
            >
              <div class="output">
                <span class="prompt">$</span>
                <span class="text-gray-400">æ¬¢è¿ä½¿ç”¨æœåŠ¡å™¨ç»ˆç«¯é¢æ¿</span>
              </div>
            </div>

            <!-- å‘½ä»¤è¾“å…¥åŒº -->
            <div class="flex items-center bg-gray-800 px-3 py-2 rounded gap-2">
              <button
                onclick="runCommand(true)"
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm"
              >
                RE
              </button>
              <span class="prompt">$</span>
              <input
                type="text"
                id="cmd"
                class="flex-1 bg-transparent text-white ml-2 min-w-0"
                placeholder="è¾“å…¥å‘½ä»¤..."
                autocomplete="off"
                autofocus
              />
              <button
                onclick="runCommand(false)"
                class="bg-cyan-600 text-white px-4 py-1 ml-1 rounded text-sm"
              >
                æ‰§è¡Œ
              </button>
            </div>

            <!-- ä¸‹è½½æ–‡ä»¶è¾“å…¥åŒº -->
            <div
              class="flex items-center bg-gray-800 px-3 py-2 rounded gap-2 mt-2"
            >
              <input
                type="text"
                id="downloadUrl"
                class="flex-1 bg-transparent text-white ml-2 min-w-0"
                placeholder="è¾“å…¥ä¸‹è½½é“¾æ¥..."
              />
              <button
                onclick="downloadFile()"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded text-sm"
              >
                ä¸‹è½½æ–‡ä»¶
              </button>
            </div>
          </div>
        </section>

        <!-- æ–‡ä»¶ç®¡ç†å™¨ -->
        <section
          class="flex-1 bg-gray-800 rounded-xl shadow-lg p-4 min-w-0 flex flex-col"
        >
          <!-- æ–‡ä»¶æ“ä½œæ : å¯†ç  + ä¸Šä¼ /åˆ·æ–° -->
          <div
            class="mb-4 flex flex-col sm:flex-row items-center justify-between gap-3"
          >
            <div class="flex items-center gap-3 flex-1 min-w-0">
              <label>æ–‡ä»¶å¯†ç ï¼š</label>
              <input
                type="password"
                id="unipass"
                placeholder="è¾“å…¥å¯†ç "
                value="guest"
                class="bg-gray-700 text-white px-2 py-1 rounded text-sm flex-1 min-w-0"
              />
            </div>
            <form
              id="uploadForm"
              enctype="multipart/form-data"
              onsubmit="return uploadFile(event)"
              class="flex items-center gap-2"
            >
              <input
                type="file"
                id="uploadInput"
                name="file"
                required
                class="hidden"
              />
              <label
                for="uploadInput"
                class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm cursor-pointer"
                >é€‰æ‹©æ–‡ä»¶</label
              >
              <button
                type="submit"
                class="bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded text-sm"
              >
                ä¸Šä¼ 
              </button>
              <button
                type="button"
                onclick="fetchFileList(currentFolder)"
                class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm"
              >
                åˆ·æ–°
              </button>
            </form>
          </div>

          <!-- æ–‡ä»¶åˆ—è¡¨ -->
          <div
            id="file-list"
            class="space-y-2 text-sm flex-1 overflow-y-auto min-w-0"
          ></div>
        </section>
      </div>
    </div>

    <script>
      let commandHistory = [];
      let historyIndex = -1;
      let currentFolder = "";

      // æœåŠ¡å™¨ç›‘æ§
      let servers = JSON.parse(localStorage.getItem("servers") || "[]");

      // æ·»åŠ  guest æœåŠ¡å™¨å¹¶æ”¾åœ¨ç¬¬ä¸€ä½ï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰
      const hasGuest = servers.some((s) => s.host === "guest");
      if (!hasGuest) {
        servers.unshift({ host: "guest", port: "", tag: "guest" });
      }

      // å¦‚æœ servers é•¿åº¦ä»ä¸º 0ï¼ˆä¸å¤ªå¯èƒ½äº†ï¼‰ï¼Œæ·»åŠ é»˜è®¤ localhost
      if (servers.length === 0) {
        const host = window.location.hostname;
        const port = window.location.port;
        const tag = "localhost";
        servers.push({ host, port, tag });
      }

      // è®¾ç½®å½“å‰æœåŠ¡å™¨ç´¢å¼•ä¸º guestï¼ˆå³ 0ï¼‰
      let currentServerIndex = 0;
      let currentServer = servers[currentServerIndex];

      localStorage.setItem("servers", JSON.stringify(servers));
      localStorage.setItem("currentServerIndex", "0");

      function showServerInfo(name) {
        if (name === "guest") {
          document.getElementById("server-info").classList.remove("hidden");
          document
            .getElementById("server-info")
            .scrollIntoView({ behavior: "smooth" });
        }
      }

      function serverToUrl(s) {
        if (s.host === "guest") return "https://guest"; // ä¾› fetch é’©å­è¯†åˆ«
        const protocol = window.location.protocol;
        const port = s.port ? `:${s.port}` : "";
        return `${protocol}//${s.host}${port}`;
      }

      function addServer() {
        const input = document.getElementById("newServer");
        const tagInput = document.getElementById("serverTag");
        const val = input.value.trim();
        const tag = tagInput.value.trim();
        if (val) {
          const [host, port] = val.split(":");
          servers.push({ host, port: port || "", tag });
          localStorage.setItem("servers", JSON.stringify(servers));
          selectServer(servers.length - 1);
          input.value = "";
          tagInput.value = "";
        }
      }

      function removeServer(ev, idx) {
        ev.stopPropagation();
        servers.splice(idx, 1);
        if (servers.length === 0) {
          servers.push({
            host: window.location.hostname,
            port: window.location.port,
            tag: "",
          });
          idx = 0;
        }
        if (currentServerIndex >= servers.length)
          currentServerIndex = servers.length - 1;
        currentServer = servers[currentServerIndex];
        localStorage.setItem("servers", JSON.stringify(servers));
        localStorage.setItem("currentServerIndex", currentServerIndex);
        renderServers();
        fetchFileList();
      }

      function selectServer(idx) {
        currentServerIndex = idx;
        currentServer = servers[idx];
        localStorage.setItem("currentServerIndex", idx);
        renderServers();
        fetchFileList();
      }

      function getMonitorPass() {
        return document.getElementById("monitorPass").value.trim();
      }

      async function fetchInfo(server) {
        const pass = encodeURIComponent(getMonitorPass());
        const res = await fetch(`${serverToUrl(server)}/info?admin=${pass}`);
        let data = {};
        try {
          data = await res.json();
        } catch (_) {}
        if (!res.ok || data.error) {
          const msg = (data && data.error) || res.statusText || "è¯·æ±‚å¤±è´¥";
          throw new Error(msg);
        }
        return data;
      }

      async function renderServers() {
        const wrap = document.getElementById("server-cards");
        wrap.innerHTML = "";
        servers.forEach((s, idx) => {
          const card = document.createElement("div");
          const hostPort = `${s.host}${s.port ? ":" + s.port : ""}`;
          const label = s.tag ? `${s.tag}` : hostPort;
          card.className =
            "bg-gray-800 rounded-lg p-4 shadow space-y-1 cursor-pointer";
          if (idx === currentServerIndex)
            card.classList.add("ring", "ring-cyan-500");
          card.onclick = () => selectServer(idx);
          card.innerHTML = `<div class="flex justify-between items-center">
             <h3 class="text-cyan-400">${label}</h3>
             <button onclick="removeServer(event, ${idx})" class="text-red-400 hover:text-red-300">Ã—</button>
           </div>
           <div>åŠ è½½ä¸­...</div>`;
          wrap.appendChild(card);
        });
        // fetch info sequentially
        for (let i = 0; i < servers.length; i++) {
          const card = wrap.children[i];
          const s = servers[i];
          try {
            const info = await fetchInfo(s);
            const memUsed = (info.memory.active / 1073741824).toFixed(1);
            const memTotal = (info.memory.total / 1073741824).toFixed(1);
            const cpu = info.cpu.currentLoad.toFixed(1);
            const diskUsed = (
              info.disk.reduce((a, b) => a + b.used, 0) / 1073741824
            ).toFixed(1);
            const diskTotal = (
              info.disk.reduce((a, b) => a + b.size, 0) / 1073741824
            ).toFixed(1);
            const net = info.network[0];
            const rx = (net.rx_bytes / 1048576).toFixed(1);
            const tx = (net.tx_bytes / 1048576).toFixed(1);
            const iface =
              info.ip.find((i) => i.ip4 && !i.internal) || info.ip[0] || {};
            const hostPort = `${s.host}${s.port ? ":" + s.port : ""}`;
            const label = s.tag ? `${s.tag}` : hostPort;
            card.innerHTML =
              `<h3 class="text-cyan-400 mb-1">${label}</h3>` +
              `<div>CPU: <span class="text-lime-400">${cpu}%</span></div>` +
              `<div>å†…å­˜: ${memUsed}/${memTotal} GB</div>` +
              `<div>ç£ç›˜: ${diskUsed}/${diskTotal} GB</div>` +
              `<div>æµé‡: ${rx}/${tx} MB</div>` +
              `<div>IP: ${iface.ip4 || "-"} ${info.os.distro}</div>`;
          } catch (e) {
            const hostPort = `${s.host}${s.port ? ":" + s.port : ""}`;
            const label = s.tag ? `${s.tag}` : hostPort;
            card.innerHTML =
              `<h3 class="text-cyan-400 mb-1">${label}</h3>` +
              `<div class="text-red-400">${e.message}</div>`;
          }
        }
      }

      renderServers();
      setInterval(renderServers, 600000);

      // é€‰ä¸­æ–‡ä»¶åæ˜¾ç¤ºå¾…ä¸Šä¼ æ–‡ä»¶
      document
        .getElementById("uploadInput")
        .addEventListener("change", () => fetchFileList(currentFolder));

      // æ¸…ç©ºç»ˆç«¯è¾“å‡º
      function clearOutput() {
        document.getElementById("output").innerHTML = "";
      }

      // æ—¥å¿—è¾“å‡ºå‡½æ•°
      function logToOutput(message, isError = false) {
        const output = document.getElementById("output");
        const line = document.createElement("div");
        line.className = "output" + (isError ? " error" : "");
        line.innerHTML = `<span class="prompt">></span> ${message}`;
        output.appendChild(line);
        output.scrollTop = output.scrollHeight;
      }

      // æ‰§è¡Œå‘½ä»¤
      function runCommand(useRe) {
        const admin = document.getElementById("admin").value.trim();
        const command = document.getElementById("cmd").value.trim();
        if (!command) return;
        commandHistory.push(command);
        historyIndex = commandHistory.length;
        logToOutput(`<span class="command">${command}</span>`);
        logToOutput("æ‰§è¡Œä¸­...");
        fetch(
          `${serverToUrl(currentServer)}/bash/${encodeURIComponent("date && " + command)}?admin=${admin}${useRe ? "&re=1" : ""}`,
        )
          .then((res) => res.text())
          .then((data) => {
            logToOutput(data.replace(/\n/g, "<br>"));
            document.getElementById("cmd").value = "";
          })
          .catch((err) => logToOutput(`é”™è¯¯: ${err.message}`, true));
      }

      // ä¸‹è½½ URL æ–‡ä»¶
      function downloadFile() {
        const url = document.getElementById("downloadUrl").value.trim();
        if (!url) return logToOutput("è¯·è¾“å…¥ä¸‹è½½é“¾æ¥", true);
        document.getElementById("cmd").value = `wget ${url}`;
        runCommand(false);
        document.getElementById("downloadUrl").value = "";
      }

      // å‘½ä»¤å†å²å¯¼èˆª
      document.getElementById("cmd").addEventListener("keydown", (e) => {
        if (e.key === "Enter") runCommand(false);
        else if (e.key === "ArrowUp") {
          e.preventDefault();
          if (historyIndex > 0) e.target.value = commandHistory[--historyIndex];
        } else if (e.key === "ArrowDown") {
          e.preventDefault();
          if (historyIndex < commandHistory.length - 1)
            e.target.value = commandHistory[++historyIndex];
          else {
            historyIndex = commandHistory.length;
            e.target.value = "";
          }
        }
      });

      // ä¸Šä¼ æ–‡ä»¶
      async function uploadFile(e) {
        e.preventDefault();
        const pwd = document.getElementById("unipass").value;
        const fileInput = document.getElementById("uploadInput");
        if (!pwd || !fileInput.files.length)
          return logToOutput("è¯·é€‰æ‹©æ–‡ä»¶å¹¶è¾“å…¥å¯†ç ", true);
        const form = new FormData();
        form.append("file", fileInput.files[0]);
        form.append("password", pwd);
        form.append("folder", currentFolder);
        try {
          const res = await fetch(`${serverToUrl(currentServer)}/file`, {
            method: "POST",
            body: form,
          });
          const text = await res.text();
          if (res.ok) {
            logToOutput(`ä¸Šä¼ æˆåŠŸ: ${fileInput.files[0].name}`);
            fileInput.value = "";
            fetchFileList(currentFolder);
          } else {
            logToOutput(`ä¸Šä¼ å¤±è´¥: ${text}`, true);
          }
        } catch (err) {
          logToOutput(`ä¸Šä¼ å¼‚å¸¸: ${err.message}`, true);
        }
        return false;
      }

      // åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
      async function deleteFile(path) {
        const pwd = document.getElementById("unipass").value;
        if (!pwd) return logToOutput("è¯·è¾“å…¥å¯†ç ", true);
        if (!confirm(`ç¡®å®šåˆ é™¤ ${path} å—ï¼Ÿ`)) return;
        const params = new URLSearchParams({ filepath: path, password: pwd });
        try {
          const res = await fetch(`${serverToUrl(currentServer)}/rmdir`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: params,
          });
          const text = await res.text();
          if (res.ok) {
            logToOutput(`å·²åˆ é™¤: ${path}`);
            fetchFileList(currentFolder);
          } else {
            logToOutput(`åˆ é™¤å¤±è´¥: ${text}`, true);
          }
        } catch (err) {
          logToOutput(`åˆ é™¤å¼‚å¸¸: ${err.message}`, true);
        }
      }

      // è·å–å¹¶æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
      async function fetchFileList(folder = "") {
        currentFolder = folder;
        const c = document.getElementById("file-list");
        c.innerHTML =
          '<div class="text-gray-400 animate-pulse">åŠ è½½ä¸­...</div>';
        try {
          const res = await fetch(
            `${serverToUrl(currentServer)}/api/files?folder=${encodeURIComponent(folder)}`,
          );
          const data = await res.json();
          const parent = folder.split("/").slice(0, -1).join("/");

          let html =
            `<div class="bg-gray-700 p-3 rounded flex justify-between items-center hover:bg-gray-600 min-w-0">` +
            `<div class="flex items-center space-x-2 min-w-0 flex-1 truncate">` +
            `<span class="text-cyan-300">â¬…</span>` +
            `<button onclick="fetchFileList('${parent}')" class="truncate text-left min-w-0">ä¸Šä¸€çº§</button>` +
            `</div></div>`;

          const pending = document.getElementById("uploadInput").files[0];
          if (pending) {
            html +=
              `<div class="bg-gray-700 p-3 rounded flex items-center hover:bg-gray-600 min-w-0">` +
              `<span class="text-yellow-300">â³</span>` +
              `<span class="truncate ml-2">${pending.name} (å¾…ä¸Šä¼ )</span>` +
              `</div>`;
          }

          data.folders.forEach((f) => {
            html +=
              `<div class="bg-gray-700 p-3 rounded flex justify-between items-center hover:bg-gray-600 min-w-0">` +
              `<span class="text-yellow-300">ğŸ“</span>` +
              `<button onclick="fetchFileList('${f.path}')" class="truncate text-left flex-1 ml-2">${f.name}</button>` +
              `</div>`;
          });

          data.files.forEach((f) => {
            let downloadLink = `${serverToUrl(currentServer)}/files/${f.path}`;
            if (f.name === "README.md" && currentServer.host === "guest") {
              downloadLink = "https://raw.githubusercontent.com/valetzx/nodejs-shell/refs/heads/main/README.md";
            } else if (f.name === ">> Click TO MY Github <<" && currentServer.host === "guest") {
              downloadLink = "https://github.com/valetzx/nodejs-shell";
            } else if (f.name === "test.jpg" && currentServer.host === "guest") {
              downloadLink = "https://www.dmoe.cc/random.php";
            }
            html += `
            <div class="bg-gray-700 p-3 rounded flex justify-between items-center hover:bg-gray-600 min-w-0">
              <div class="flex items-center space-x-2 min-w-0 flex-1 truncate">
                <span class="text-green-300">ğŸ“„</span>
                <a href="${downloadLink}" download class="truncate text-blue-300 hover:underline">${f.name}</a>
              </div>
              <button onclick="deleteFile('${f.path}')" class="text-orange-400 hover:text-orange-300">åˆ é™¤</button>
            </div>`;
          });

          c.innerHTML = html;
        } catch (err) {
          logToOutput(`è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${err.message}`, true);
        }
      }

      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function randomFloat(min, max, decimals = 1) {
        const factor = Math.pow(10, decimals);
        return (
          Math.round((Math.random() * (max - min) + min) * factor) / factor
        );
      }

      function generateGuestInfo() {
        return {
          cpu: { currentLoad: randomFloat(3, 90) },
          memory: {
            active: randomInt(1, 6) * 1024 ** 3,
            total: randomInt(5, 8) * 1024 ** 3,
          },
          disk: [
            {
              used: randomInt(10, 80) * 1024 ** 3,
              size: randomInt(60, 100) * 1024 ** 3,
            },
            {
              used: randomInt(5, 50) * 1024 ** 3,
              size: randomInt(10, 80) * 1024 ** 3,
            },
          ],
          network: [
            {
              rx_bytes: randomInt(100, 1000) * 1024 ** 2,
              tx_bytes: randomInt(200, 2000) * 1024 ** 2,
            },
          ],
          ip: [{ ip4: `192.168.0.${randomInt(1, 254)}`, internal: false }],
          os: { distro: `GuestOS ${randomFloat(1.0, 2.0, 1)}` },
        };
      }

      const guestInfo = generateGuestInfo();

      // æŒ‰éœ€ç”Ÿæˆæ–‡ä»¶/æ–‡ä»¶å¤¹æ ‘
      function buildGuestFiles(folder = "") {
        const tree = {
          "": {
            folders: ["Images", "Documents"],
            files: [">> Click TO MY Github <<", "guest.txt", "README.md"],
          },
          Images: {
            folders: [],
            files: ["guest.jpg", "test.jpg", "README.md"],
          },
        };
        const node = tree[folder] || { folders: [], files: [] };
        return {
          folders: node.folders.map((n) => ({
            name: n,
            path: folder ? `${folder}/${n}` : n,
          })),
          files: node.files.map((n) => ({
            name: n,
            path: folder ? `${folder}/${n}` : n,
          })),
        };
      }

      // fetch æ›¿èº«
      const _fetch = window.fetch.bind(window);
      window.fetch = function (input, init = {}) {
        const url = typeof input === "string" ? input : input.url;
        if (url.startsWith("https://guest")) {
          let body = "",
            status = 200,
            headers = { "Content-Type": "application/json" };

          if (url.includes("/info")) {
            body = JSON.stringify(generateGuestInfo());
          } else if (url.includes("/api/files")) {
            const p = new URL(url).searchParams.get("folder") || "";
            body = JSON.stringify(buildGuestFiles(p));
          } else {
            body = "Guest placeholder";
            headers["Content-Type"] = "text/plain";
          }
          return Promise.resolve(new Response(body, { status, headers }));
        }
        return _fetch(input, init); // å…¶å®ƒæœåŠ¡å™¨ç…§å¸¸è¯·æ±‚
      };
      function applyToggleState() {
        const serverCards = document.getElementById("server-cards");
        serverCards.style.display = document.getElementById("toggleServers")
          .checked
          ? "grid"
          : "none";
      }

      document
        .getElementById("toggleServers")
        .addEventListener("change", applyToggleState);

      // é»˜è®¤åˆå§‹æ”¶èµ·
      document.getElementById("toggleServers").checked = false;
      applyToggleState();

      // åˆå§‹åŒ–åˆ—è¡¨åŠ è½½
      window.onload = () => {
        fetchFileList();
        document.getElementById("cmd").focus();
      };
    </script>
  </body>
</html>
